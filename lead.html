<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D In-Vitro Models - Lead Generation Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // Icon Components (Simplified)
        const Search = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Download = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const Upload = () => <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const ArrowUpDown = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21 16-4 4-4-4"/><path d="M17 20V4"/><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/></svg>;
        const Users = () => <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const TrendingUp = () => <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const MapPin = () => <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>;
        const FileText = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>;

        const LeadGenDashboard = () => {
            const [leads, setLeads] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: 'score', direction: 'desc' });
            const [uploadStatus, setUploadStatus] = useState('');

            const parseCSV = (text) => {
                const lines = text.split('\n').filter(line => line.trim());
                if (lines.length < 2) return [];
                
                const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/['"]/g, ''));
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = [];
                    let currentValue = '';
                    let insideQuotes = false;
                    
                    for (let char of lines[i]) {
                        if (char === '"') {
                            insideQuotes = !insideQuotes;
                        } else if (char === ',' && !insideQuotes) {
                            values.push(currentValue.trim().replace(/^["']|["']$/g, ''));
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    values.push(currentValue.trim().replace(/^["']|["']$/g, ''));
                    
                    if (values.length === headers.length) {
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        data.push(row);
                    }
                }
                
                return data;
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.name.endsWith('.csv')) {
                    setUploadStatus('Error: Please upload a CSV file');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const parsedData = parseCSV(text);
                        
                        if (parsedData.length === 0) {
                            setUploadStatus('Error: No data found in CSV');
                            return;
                        }
                        
                        const normalizedData = parsedData.map(row => ({
                            name: row.name || row.Name || '',
                            title: row.title || row.Title || '',
                            company: row.company || row.Company || '',
                            location: row.location || row.Location || row.person_location || '',
                            company_hq: row.company_hq || row.Company_HQ || row.companyhq || row.location || '',
                            linkedin_url: row.linkedin_url || row.LinkedIn_URL || row.linkedin || '',
                            recent_paper: row.recent_paper || row.Recent_Paper || 'No',
                            paper_year: row.paper_year || row.Paper_Year || '',
                            recent_funding: row.recent_funding || row.Recent_Funding || 'No',
                            uses_similar_tech: row.uses_similar_tech || row.Uses_Similar_Tech || 'No'
                        }));
                        
                        setLeads(normalizedData);
                        setUploadStatus(`Success! Loaded ${normalizedData.length} leads`);
                        setTimeout(() => setUploadStatus(''), 3000);
                    } catch (error) {
                        setUploadStatus('Error: Failed to parse CSV file');
                    }
                };
                
                reader.readAsText(file);
            };

            const calculateScore = (lead) => {
                let score = 0;
                const titleKeywords = ['toxicology', 'safety', 'hepatic', '3d', 'preclinical', 'dmpk', 'pharmacology', 'toxicologist', 'assessment'];
                if (titleKeywords.some(kw => lead.title.toLowerCase().includes(kw))) score += 30;
                if (lead.recent_funding && lead.recent_funding.toLowerCase().includes('yes')) score += 20;
                if (lead.uses_similar_tech && lead.uses_similar_tech.toLowerCase().includes('yes')) score += 15;
                const hubs = ['boston', 'cambridge', 'san francisco', 'bay area', 'basel', 'oxford'];
                const locationText = `${lead.location} ${lead.company_hq}`.toLowerCase();
                if (hubs.some(hub => locationText.includes(hub))) score += 10;
                if (lead.recent_paper && lead.recent_paper.toLowerCase().includes('yes')) {
                    const year = parseInt(lead.paper_year);
                    if (!isNaN(year) && year >= 2023) score += 40;
                    else if (!lead.paper_year) score += 40;
                }
                const namsKeywords = ['research', 'development', 'innovation'];
                if (namsKeywords.some(kw => lead.title.toLowerCase().includes(kw))) score += 10;
                return Math.min(score, 100);
            };

            const scoredLeads = useMemo(() => {
                return leads.map(lead => ({
                    ...lead,
                    score: calculateScore(lead),
                    is_remote: lead.location.toLowerCase() !== lead.company_hq.toLowerCase()
                }));
            }, [leads]);

            const filteredLeads = useMemo(() => {
                if (!searchTerm) return scoredLeads;
                const search = searchTerm.toLowerCase();
                return scoredLeads.filter(lead => 
                    lead.name.toLowerCase().includes(search) ||
                    lead.title.toLowerCase().includes(search) ||
                    lead.company.toLowerCase().includes(search) ||
                    lead.location.toLowerCase().includes(search)
                );
            }, [scoredLeads, searchTerm]);

            const sortedLeads = useMemo(() => {
                const sorted = [...filteredLeads];
                sorted.sort((a, b) => {
                    let aVal = a[sortConfig.key];
                    let bVal = b[sortConfig.key];
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    if (aVal < bVal) return sortConfig.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
                return sorted;
            }, [filteredLeads, sortConfig]);

            const handleSort = (key) => {
                setSortConfig(prev => ({
                    key,
                    direction: prev.key === key && prev.direction === 'asc' ? 'desc' : 'asc'
                }));
            };

            const exportToCSV = () => {
                const headers = ['Rank', 'Score', 'Name', 'Title', 'Company', 'Location', 'Company_HQ', 'LinkedIn', 'Remote'];
                const rows = sortedLeads.map((lead, index) => [
                    index + 1, lead.score, lead.name, lead.title, lead.company,
                    lead.location, lead.company_hq, lead.linkedin_url, lead.is_remote ? 'Yes' : 'No'
                ]);
                const csvContent = [headers.join(','), ...rows.map(row => row.map(cell => `"${cell}"`).join(','))].join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'scored_leads.csv';
                a.click();
            };

            const downloadTemplate = () => {
                const headers = ['Name', 'Title', 'Company', 'Location', 'LinkedIn_URL', 'Company_HQ', 'Recent_Paper', 'Paper_Year', 'Recent_Funding', 'Uses_Similar_Tech'];
                const sample = ['Dr. John Smith', 'Director of Toxicology', 'Biotech Corp', 'Boston, MA', 'linkedin.com/in/johnsmith', 'Boston, MA', 'Yes', '2024', 'Yes', 'Yes'];
                const csvContent = [headers.join(','), sample.join(',')].join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'leads_template.csv';
                a.click();
            };

            const stats = useMemo(() => {
                if (sortedLeads.length === 0) return { total: 0, highValue: 0, avgScore: 0 };
                const highValue = sortedLeads.filter(l => l.score >= 70).length;
                const avgScore = sortedLeads.reduce((sum, l) => sum + l.score, 0) / sortedLeads.length;
                return { total: sortedLeads.length, highValue, avgScore: avgScore.toFixed(1) };
            }, [sortedLeads]);

            const getScoreColor = (score) => {
                if (score >= 70) return 'bg-green-100 text-green-800';
                if (score >= 40) return 'bg-yellow-100 text-yellow-800';
                return 'bg-gray-100 text-gray-800';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-900 mb-2">3D In-Vitro Models - Lead Generation Dashboard</h1>
                            <p className="text-gray-600">Automated lead scoring and prioritization for biotech sales</p>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h2 className="text-xl font-semibold text-gray-900 mb-4">Upload Your Leads CSV</h2>
                            <div className="flex flex-col md:flex-row gap-4 items-start">
                                <div className="flex-1">
                                    <label className="flex items-center justify-center w-full px-6 py-8 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 hover:bg-gray-50 transition-colors">
                                        <div className="text-center">
                                            <div className="mx-auto mb-2 text-gray-400"><Upload /></div>
                                            <p className="text-sm text-gray-600 mb-1">
                                                <span className="font-semibold text-indigo-600">Click to upload</span> or drag and drop
                                            </p>
                                            <p className="text-xs text-gray-500">CSV file with your leads</p>
                                        </div>
                                        <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                                    </label>
                                    {uploadStatus && (
                                        <div className={`mt-3 p-3 rounded-lg ${uploadStatus.includes('Error') ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>
                                            {uploadStatus}
                                        </div>
                                    )}
                                </div>
                                <div className="flex flex-col gap-2">
                                    <button onClick={downloadTemplate} className="flex items-center gap-2 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                        <FileText /> Download Template
                                    </button>
                                    <div className="text-xs text-gray-600 mt-2 space-y-1">
                                        <p className="font-semibold">Required: Name, Title, Company, Location, LinkedIn_URL</p>
                                        <p className="font-semibold mt-2">Optional: Company_HQ, Recent_Paper, Paper_Year, Recent_Funding, Uses_Similar_Tech</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {leads.length > 0 && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <div className="flex items-center justify-between">
                                            <div><p className="text-sm text-gray-600">Total Leads</p><p className="text-3xl font-bold text-gray-900">{stats.total}</p></div>
                                            <div className="text-blue-500"><Users /></div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <div className="flex items-center justify-between">
                                            <div><p className="text-sm text-gray-600">High Value (70+)</p><p className="text-3xl font-bold text-green-600">{stats.highValue}</p></div>
                                            <div className="text-green-500"><TrendingUp /></div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <div className="flex items-center justify-between">
                                            <div><p className="text-sm text-gray-600">Avg Score</p><p className="text-3xl font-bold text-indigo-600">{stats.avgScore}</p></div>
                                            <div className="text-indigo-500"><MapPin /></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                    <div className="flex flex-col md:flex-row gap-4">
                                        <div className="flex-1 relative">
                                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"><Search /></div>
                                            <input type="text" placeholder="Search by name, title, company, or location..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                        <button onClick={exportToCSV} className="flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                            <Download /> Export Scored CSV
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-gray-50 border-b-2 border-gray-200">
                                                <tr>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                                                    <th onClick={() => handleSort('score')} className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                                        <div className="flex items-center gap-2">Score <ArrowUpDown /></div>
                                                    </th>
                                                    <th onClick={() => handleSort('name')} className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                                        <div className="flex items-center gap-2">Name <ArrowUpDown /></div>
                                                    </th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                                    <th onClick={() => handleSort('company')} className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100">
                                                        <div className="flex items-center gap-2">Company <ArrowUpDown /></div>
                                                    </th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">HQ</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">LinkedIn</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {sortedLeads.map((lead, index) => (
                                                    <tr key={index} className="hover:bg-gray-50">
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#{index + 1}</td>
                                                        <td className="px-4 py-4 whitespace-nowrap">
                                                            <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getScoreColor(lead.score)}`}>{lead.score}</span>
                                                        </td>
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{lead.name}</td>
                                                        <td className="px-4 py-4 text-sm text-gray-700">{lead.title}</td>
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">{lead.company}</td>
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            {lead.location}
                                                            {lead.is_remote && <span className="ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">Remote</span>}
                                                        </td>
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">{lead.company_hq}</td>
                                                        <td className="px-4 py-4 whitespace-nowrap text-sm">
                                                            {lead.linkedin_url && (
                                                                <a href={lead.linkedin_url.startsWith('http') ? lead.linkedin_url : `https://${lead.linkedin_url}`} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                                                                    View Profile
                                                                </a>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6 mt-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-4">Scoring Breakdown</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Relevant Title Match</span><span className="font-semibold">+30</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Recent Publication (2023+)</span><span className="font-semibold">+40</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Recent Funding</span><span className="font-semibold">+20</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Uses Similar Tech</span><span className="font-semibold">+15</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Biotech Hub Location</span><span className="font-semibold">+10</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                            <span>Open to NAMs</span><span className="font-semibold">+10</span>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<LeadGenDashboard />, document.getElementById('root'));
    </script>
</body>
</html>